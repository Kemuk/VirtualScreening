# Main Workflow Configuration for Virtual Screening Pipeline
# =============================================================

# Workflow metadata
workflow_name: "virtual_screening_pipeline"
dataset: "LIT_PCBA"

# Execution Mode
# --------------
# mode: "devel", "test", or "production"
#   - devel: Quick local testing with minimal data (1 target, ~100 ligands)
#   - test: Intermediate testing with subset of data
#   - production: Full dataset processing
mode: "production"

# Mode-specific settings
# ----------------------
devel:
  targets: null                    # null = all targets, or list like ["ADRB2"]
  actives_per_protein: 5
  inactives_per_protein: 10
  aev_plig_shards: 5

test:
  targets: null
  actives_per_protein: 100
  inactives_per_protein: 900
  aev_plig_shards: 10

production:
  targets: null                    # All targets
  actives_per_protein: null        # All actives (no limit)
  inactives_per_protein: null      # All inactives (no limit)
  aev_plig_shards: 100

# Paths
# -----
dataset_dir: "LIT_PCBA"            # Root directory for target data
manifest_dir: "data/master"        # Parquet manifest storage
results_dir: "results"             # Analysis outputs
logs_dir: "data/logs"              # Snakemake execution logs

# Targets configuration file
targets_config: "config/targets.yaml"

# Docking Configuration
# ---------------------
docking:
  mode: "gpu"                      # "gpu" or "cpu"
  exhaustiveness: 8                # Vina exhaustiveness (GNINA default)
  num_modes: 9                     # Number of binding modes to generate
  energy_range: 3                  # Energy range for binding modes (kcal/mol)
  seed: 42                         # Random seed for reproducibility

# Default Box Sizes
# -----------------
# Used for all targets unless overridden in targets.yaml
default_box_size:
  x: 25.0
  y: 25.0
  z: 25.0

# GPU Settings
# ------------
gpu:
  threads: 8000                    # GPU thread count for Vina-GPU
  device_id: 0                     # Default CUDA device

# CPU Settings
# ------------
cpu:
  threads: 8                       # CPU thread count for Vina
  runtime_workers: 4               # Parallel docking jobs on CPU

# Preparation Parameters
# ----------------------
preparation:
  ph: 7.4                          # pH for protonation states
  partial_charge: "gasteiger"      # Charge calculation method
  gen3d: true                      # Generate 3D coordinates from SMILES

# SDF Conversion
# --------------
sdf_conversion:
  select_model: 0                  # Which binding mode to extract (0 = best)

# AEV-PLIG Rescoring
# ------------------
rescoring:
  enabled: true                    # Enable/disable AEV-PLIG rescoring
  model_name: "model_GATv2Net_ligsim90_fep_benchmark"

# Results Configuration
# ---------------------
results:
  bootstrap_iterations: 1000       # Bootstrap iterations for CIs
  bedroc_alpha: 20.0               # BEDROC alpha parameter
  enrichment_fractions:            # Fractions for enrichment factors
    - 0.01
    - 0.05
    - 0.10

# Ligand-Based Methods
# --------------------
ligand_based:
  enabled: false                   # Enable/disable ligand-based screening
  n_jobs: 8                        # Parallel jobs for ligand-based methods
  methods:
    - "fingerprint"
    - "shape"
    - "pharmacophore"

# External Tools
# --------------
tools:
  vina_gpu: "vina-gpu-dev/QuickVina2-GPU-2-1"
  vina_cpu: "vina"
  obabel: "obabel"
  aev_plig_dir: "AEV-PLIG"

# =============================================================================
# SLURM Array Job Configuration
# =============================================================================
# Stage-specific settings for the SLURM orchestrator.
# Override defaults in workflow/slurm/run.py

slurm:
  # Partition limits (from cluster configuration)
  partitions:
    arc:
      max_array_size: 5000
      default_time: 60        # minutes
      default_mem: "8G"
    htc:
      max_array_size: 1000
      default_time: 120
      default_mem: "16G"
      gres: "gpu:1"
    devel:
      max_array_size: 100
      default_time: 10
      default_mem: "4G"

  # Stage-specific overrides (optional)
  # If not specified, uses defaults from run.py
  # NOTE: docking partition is determined by docking.mode (gpu -> htc, cpu -> arc)
  stages:
    docking:
      # partition: determined by docking.mode above
      time: 60
      mem: "16G"
    aev_infer:
      partition: htc
      time: 120
      mem: "16G"
      gres: "gpu:1"
    conversion:
      partition: arc
      time: 10
      mem: "4G"
